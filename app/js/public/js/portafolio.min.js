var Backbone=require("backbone"),$=require("jquery"),PortadasCollection=require("../collections/portadas"),PortadasView=require("../views/portadas"),TrabajosCollection=require("../collections/trabajos"),TrabajosView=require("../views/trabajos"),PortadaModel=require("../models/portada"),TrabajoModel=require("../models/trabajo");module.exports=Backbone.Router.extend({routes:{"":"index",":name":"work"},initialize:function(){this.current={},this.jsonData={},this.totalProyectos,this.contadorProyectos=0,this.portadas=new PortadasCollection,this.portadasView=new PortadasView({collection:this.portadas}),this.trabajos=new TrabajosCollection,this.trabajosView=new TrabajosView({collection:this.trabajos}),Backbone.history.start()},index:function(){this.trabajos.reset(),this.fetchData(),$("#btn-portafolio-behance").show()},work:function(a){if($("#btn-portafolio-behance").hide(),this.portadas.reset(),0===Object.keys(this.jsonData).length){console.log("Cargo la data JSON porque estoy accediendo directamente a un trabajo");var o=this;this.fetchData("detalle").done(function(){o.addTrabajo(a)})}else console.log("Hago uso de ls data JSON ya cargada"),this.addTrabajo(a)},fetchData:function(a){var o=this;return this.contadorProyectos=0,$.getJSON("data/portafolio.json").then(function(t){if(o.jsonData=t,o.totalProyectos=Object.keys(o.jsonData).length,"detalle"!=a)for(var e in t)t.hasOwnProperty(e)&&o.addPortada(e,t[e])})},addPortada:function(a,o){this.portadas.add(new PortadaModel({nombre:a,imagen_portada:o.img_portada,estado:o.estado})),this.contadorProyectos++,this.contadorProyectos==this.totalProyectos&&Backbone.Portafolio.fnAnimacionProgress()},addTrabajo:function(a){function o(){for(var a in t.img_slide)t.img_slide.hasOwnProperty(a)&&e.push({url:t.img_slide[a]})}this.current.trabajo=this.jsonData[a];var t=this.current.trabajo,e=[];o(),this.trabajos.add(new TrabajoModel({titulo:a,categoria:t.categoria,imagenes_slide:e,texto:t.detalle.texto,compatibilidad:t.detalle.compatibilidad,tecnologias:t.detalle.tecnologias})),Backbone.Portafolio.fnSlide()}});